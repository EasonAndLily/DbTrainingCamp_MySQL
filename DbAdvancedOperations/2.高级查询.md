# 高级查询

本节主要掌握子查询、联结查询、组合查询的语法，了解全文本搜索的相关知识和概念。



## 子查询

前面学习了各种查询，都是从单一的表中查询相关数据，这是最基本的查询。我们都知道，MySQL是关系型数据库，如果要从多个相关联表中查询数据，该怎么办？比如下面的例子：

学生信息表：

```sql
+----+-----------+-----+-----+
| id | name      | age | sex |
+----+-----------+-----+-----+
|  1 | 小明      |  18 | 男  |
|  2 | 李四      |  20 | 女  |
|  3 | 王五      |  30 | 男  |
|  4 | 王明刚    |  40 | 男  |
+----+-----------+-----+-----+
```

成绩表：

```sql
+------+------------+---------+-------+
| id   | student_id | subject | score |
+------+------------+---------+-------+
|    1 |          1 | 语文    |    80 |
|    2 |          2 | 语文    |    70 |
|    3 |          3 | 数学    |    90 |
|    4 |          4 | 数学    |    95 |
+------+------------+---------+-------+
```

现在要获取小明的语文成绩，需要查询两步：

1. 首先从学生表中找到姓名为小明的同学的id。
2. 然后通过小明同学的id从成绩表里面获取他的语文成绩。

**实现SQL为：**

```sql
SELECT score FROM score WHERE subject = '语文' AND student_id = (
SELECT id FROM student_info WHERE name = '小明'
);
```

结果为：

```sql
+-------+
| score |
+-------+
|    80 |
+-------+
1 row in set (0.01 sec)
```

上面的例子用了子查询来完成：

**子查询：允许把一个查询嵌套在另一个查询当中的查询。**

子查询分为内部查询和外部查询。内部查询就是上面例子中的：SELECT id FROM student_info WHERE name = '小明'；外部查询就是：SELECT score FROM score WHERE...。

**从上面的例子可以看出，子查询有下面几种优势：**

* 子查询有清晰的查询过程，先从内部查询开始，在到外部查询，依次从里到位的顺序对代码可读性和可理解性较好。
* 使用子查询与GROUP BY可以比较方便的创建一些计算字段。
* 对于两个或者多个没有直接物理关联的表(可能存在着一些逻辑关联)，子查询比较容易实现查询。

**凡事都有利弊，子查询也有缺陷：**

* 当查询的表过多(超过3个)，那么嵌套的查询就比较复杂，反而降低了可读性。
* 子查询是从里到外的查询，所以性能比较差。
* 外部的查询的返回结果不能包括内部查询的结果，比如想获取小明的语文成绩和年龄等就不能用子查询实现。

参考链接：

* [Subquery Syntax](https://dev.mysql.com/doc/refman/8.0/en/subqueries.html)
* [MySQL Subquery](http://www.mysqltutorial.org/mysql-subquery/)



## 联结查询

### 内联结

### 外联结

### 自然联结



## 组合查询



## 全文本搜索



## 家庭作业

