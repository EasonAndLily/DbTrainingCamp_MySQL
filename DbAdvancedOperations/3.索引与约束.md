# 索引与约束

本节主要掌握索引与约束的概念，同时也要掌握对索引的各种操作。



## 索引

用来加快查询的技术很多，其中最重要的是索引。MySQL索引的建立对于MySQL的高效运行是很重要的，索引可以大大提高MySQL的检索速度。

打个比方：比如一栋宿舍大楼里面400个宿舍，每个宿舍里面住四个学生，假如你要找到张三在哪个宿舍的话，有两种方法：

1. 就是一个宿舍一个宿舍找，直到找到张三为止；
2. 从看门大爷哪里找到一个宿舍花名册，从花名册里找到张三的宿舍号，然后直接去张三的宿舍找他。

从这两种方式看出，第二种的效率明显要高很多。数据库也是同样的道理，索引就和第二种查找方式类似，可以大规模增加查询的速度。

接下来我们详细了解一下索引吧。

### 基本概念

**索引（Index）是帮助MySQL高效获取数据的数据结构，即索引是数据结构。**



>数据库查询是数据库的最主要功能之一。我们都希望查询数据的速度能尽可能的快，因此数据库系统的设计者会从查询算法的角度进行优化。最基本的查询算法当然是顺序查找（linear search），这种复杂度为O(n)的算法在数据量很大时显然是糟糕的，好在计算机科学的发展提供了很多更优秀的查找算法，例如二分查找（binary search）、二叉树查找（binary tree search）等。如果稍微分析一下会发现，每种查找算法都只能应用于特定的数据结构之上，例如二分查找要求被检索数据有序，而二叉树查找只能应用于二叉查找树上，但是数据本身的组织结构不可能完全满足各种数据结构（例如，理论上不可能同时将两列都按顺序进行组织），所以，在数据之外，数据库系统还维护着满足特定查找算法的数据结构，这些数据结构以某种方式引用（指向）数据，这样就可以在这些数据结构上实现高级查找算法。这种数据结构，就是索引。



### 分类与操作：

对于MySQL来说，常见的索引有以下类型：

#### 普通索引

这是最基本的索引类型，而且它没有唯一性之类的限制，通常有三种方式可以创建：

1. 直接基于表创建：

   ```sql
   CREATE INDEX indexName ON table_name(column_name(length)); 
   ```

2. 修改表结构创建：

   ```sql
   ALTER table table_name ADD INDEX index_name(column_name);
   ```

3. 创建表时指定：

   ```sql
   CREATE TABLE table_name(
   ID INT NOT NULL,
   ...
   INDEX [index_name] (column_name(length))
   );
   ```

   例如：给学生表中的姓名创建普通索引：

   ```sql
   CREATE INDEX name_index ON student_info(name(50));
   ```

删除普通索引，有以下几种方法：

1. 直接删除：

   ```sql
   DROP INDEX index_name ON table_name;
   ```

2. 修改表结构删除：

   ```sql
   ALTER TABLE table_name DROP INDEX index_name;
   ```

#### 唯一索引(**UNIQUE**)

它与前面的普通索引类似，不同的就是：索引列的值必须唯一，但允许有空值。如果是组合索引，则列值的组合必须唯一。如果该字段信息保证不会重复时可设置为unique索引， 例如身份证号等。

与上面的类似，创建唯一索引有三种方法：

1. 直接基于表创建：

   ```sql
   CREATE UNIQUE INDEX indexName ON table_name(column_name(length)); 
   ```

2. 修改表结构创建：

   ```sql
   ALTER table table_name ADD UNIQUE index_name(column_name);
   ```

3. 创建表时指定：

   ```sql
   CREATE TABLE table_name(
   ID INT NOT NULL,
   ...
   UNIQUE [index_name] (column_name(length))
   );
   ```

删除唯一索引的方法与删除普通索引的方法一样，此处不再赘述。

#### 主键索引

主键是一种唯一性索引，但它必须指定为“PRIMARY KEY”，每个表只能有一个主键，通常是自增的ID，大部分在创建表的时候指定：

```sql
CREATE TABLE table_name(
ID INT NOT NULL,
...
PRIMARY KEY (column_name(length))
);
```

也可以通过修改表的方式加入主键:

```sql
ALTER table table_name ADD PRIMARY KEY (column_name);
```

**需要注意的是：**

* 不能用CREATE INDEX语句创建PRIMARY KEY索引；
* 主键索引由于每个表中只有一个，所以不需要指定索引名。

例如，给学生表的ID创建主键索引：

```sql
mysql> ALTER table student_info ADD PRIMARY KEY (id);
Query OK, 0 rows affected (0.15 sec)
Records: 0  Duplicates: 0  Warnings: 0
```



#### 全文索引

该索引几乎不用，如果大家有兴趣的话可以自己学习。



最后，希望大家掌握一种查询索引的方法：

```sql
SHOW INDEX FROM table_name;
```



参考链接：

* [MYSQL-索引](https://segmentfault.com/a/1190000003072424)
* [How MySQL Uses Indexes](https://dev.mysql.com/doc/refman/8.0/en/mysql-indexes.html)
* [MySQL - INDEXES](https://www.tutorialspoint.com/mysql/mysql-indexes.htm)
* [MySQL索引背后的数据结构及算法原理](http://blog.codinglabs.org/articles/theory-of-mysql-index.html)
* [索引的利弊与如何判定，是否需要索引](http://book.51cto.com/art/200906/132452.htm)



## 约束



## 家庭作业

1. 阅读本节参考链接，总结索引的用法和利弊权衡，写一篇博客。

