# 高可用架构

![high-avaliable-architecture](https://tva1.sinaimg.cn/large/008i3skNly1gsddenbmrrj307n053747.jpg)

归根结底，高可用性实际上意味着“更少的宕机时间”，然而更糟糕的是，高可用性经常和其他相关的概念相混淆，例如冗余、数据可靠性以及负载均衡。高可用性实际上有点像神秘的野兽，今天我们就来战胜它！

## 什么是高可用性？

高可用性通常以百分比来表示，意味着高可用性不是绝对的，只有相对更高的可用性。100%的可用性是不可能达到的。可用性的`9`规则是表示可用性目标最普遍的方法。你可能也知道，`5个9`表示`99.999%`的正常可用时间，换句话说，每年只允许5分钟的宕机时间。对于大多数应用来说，这是一个令人惊叹的数字，尽管还有一些人视图获得更多的额`9`!

在设定一个可用时间的目标之前，先问问自己，是不是确实需要达到这个目标。可用性每提高一点，所花费的成本都会远高于之前，可用性的效果和开销的比例并不是线性的。需要保证多少可用时间，取决于能够承担多少成本。

***高可用性实际上是在宕机造成的损失与降低宕机时间所花费的成本之间取得一个平衡！***

幸运的是，简历`2个9`或`3个9`的可用时间的目标可能并不困难，具体情况取决于应用。

## 是什么导致了宕机？

到底是什么原因导致宕机呢？这是一个很普遍但是很难猜测的话题，这里我们列举一些常见的宕机情况：

* 在运行环境中，最普遍的问题是磁盘空间耗尽。
* 在性能问题中，最普遍的宕机原因确实是运行很糟糕的SQL，但也不一定都是这个原因，比如也有很多问题是由于服务器Bug或错误的行为导致的。
* 糟糕的Schema和索引设计是第二大影响性能的问题。
* 复制问题通常由于主备数据不一致导致。
* 数据丢失问题通常由于Drop Table的错误操作导致，并总是伴随着缺少可用备份的问题。

## 如何实现高可用性？

可以通过同时进行以下两步来获得高可用性。

第一: 可以尝试避免导致宕机的原因来减少宕机时间。许多问题其实很容易避免，例如通过适当的配置、监控，以及规范或安全保证措施来避免人为造成的错误。

第二：尽量保证在发生宕机时能够快速恢复，最常见的测试是在系统中制造冗余，并且具备故障转移能力。

这两个维度的高可用性可以通过两个相关的度量来确定：`平均失效时间(MTBF)`和`平均恢复时间(MTTR)`。下面我们就这两个维度来看看对应的实现高可用性的方案。